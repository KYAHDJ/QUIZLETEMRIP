<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>PDF Quiz Generator | Intelligent Extraction</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<style>
    /* ===========================
       CSS VARIABLES & RESET
       =========================== */
    :root {
        --primary-50: #eff6ff;
        --primary-100: #dbeafe;
        --primary-200: #bfdbfe;
        --primary-300: #93c5fd;
        --primary-400: #60a5fa;
        --primary-500: #3b82f6;
        --primary-600: #2563eb;
        --primary-700: #1d4ed8;
        --primary-800: #1e40af;
        --primary-900: #1e3a8a;
        
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-400: #9ca3af;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --gray-900: #111827;
        
        --success-50: #f0fdf4;
        --success-500: #22c55e;
        --success-600: #16a34a;
        
        --warning-50: #fffbeb;
        --warning-500: #f59e0b;
        --warning-600: #d97706;
        
        --danger-50: #fef2f2;
        --danger-500: #ef4444;
        --danger-600: #dc2626;
        
        --radius-sm: 0.375rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --radius-xl: 1rem;
        
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        background-color: var(--gray-50);
        color: var(--gray-900);
        line-height: 1.5;
        min-height: 100vh;
    }

    /* ===========================
       TYPOGRAPHY
       =========================== */
    h1, h2, h3, h4, h5, h6 {
        font-weight: 600;
        line-height: 1.25;
        color: var(--gray-900);
    }

    h1 { font-size: 2rem; }
    h2 { font-size: 1.5rem; }
    h3 { font-size: 1.25rem; }
    h4 { font-size: 1.125rem; }

    @media (min-width: 768px) {
        h1 { font-size: 2.5rem; }
        h2 { font-size: 2rem; }
        h3 { font-size: 1.5rem; }
    }

    /* ===========================
       APP LAYOUT & HEADER
       =========================== */
    .app-container {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
    }

    .app-header {
        background: white;
        border-bottom: 1px solid var(--gray-200);
        padding: 1rem 1.5rem;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: var(--shadow-sm);
    }

    .header-content {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1.5rem;
    }

    .logo {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .logo-icon {
        width: 36px;
        height: 36px;
        background: linear-gradient(135deg, var(--primary-600), var(--primary-800));
        border-radius: var(--radius-md);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 1.125rem;
    }

    .logo-text h1 {
        font-size: 1.25rem;
        margin-bottom: 0.125rem;
    }

    .logo-text p {
        font-size: 0.875rem;
        color: var(--gray-500);
    }

    .header-actions {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    /* ===========================
       MAIN CONTENT AREA
       =========================== */
    .main-content {
        flex: 1;
        padding: 1.5rem;
        max-width: 1200px;
        margin: 0 auto;
        width: 100%;
    }

    /* ===========================
       CARDS & CONTAINERS
       =========================== */
    .card {
        background: white;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-md);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        border: 1px solid var(--gray-200);
    }

    .card-header {
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--gray-200);
    }

    /* ===========================
       TABS
       =========================== */
    .tabs {
        display: flex;
        gap: 0.5rem;
        overflow-x: auto;
        padding-bottom: 0.25rem;
        margin-bottom: 2rem;
        -webkit-overflow-scrolling: touch;
    }

    .tab {
        padding: 0.75rem 1.25rem;
        background: var(--gray-100);
        border: none;
        border-radius: var(--radius-lg);
        font-weight: 500;
        color: var(--gray-600);
        cursor: pointer;
        white-space: nowrap;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .tab:hover {
        background: var(--gray-200);
        color: var(--gray-700);
    }

    .tab.active {
        background: var(--primary-600);
        color: white;
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    /* ===========================
       UPLOAD AREA
       =========================== */
    .upload-area {
        border: 2px dashed var(--gray-300);
        border-radius: var(--radius-xl);
        padding: 3rem 2rem;
        text-align: center;
        background: var(--gray-50);
        transition: all 0.3s;
        cursor: pointer;
    }

    .upload-area:hover {
        border-color: var(--primary-500);
        background: var(--primary-50);
    }

    .upload-area.drag-over {
        border-color: var(--primary-600);
        background: var(--primary-100);
    }

    .upload-icon {
        font-size: 3rem;
        color: var(--primary-500);
        margin-bottom: 1rem;
    }

    .upload-text h3 {
        margin-bottom: 0.5rem;
        color: var(--gray-900);
    }

    .upload-text p {
        color: var(--gray-500);
        margin-bottom: 1.5rem;
        max-width: 500px;
        margin-left: auto;
        margin-right: auto;
    }

    .file-input {
        display: none;
    }

    .upload-btn {
        background: var(--primary-600);
        color: white;
        border: none;
        border-radius: var(--radius-lg);
        padding: 0.75rem 1.5rem;
        font-weight: 500;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.2s;
    }

    .upload-btn:hover {
        background: var(--primary-700);
        transform: translateY(-1px);
    }

    .file-info {
        margin-top: 1.5rem;
        padding: 1rem;
        background: var(--gray-100);
        border-radius: var(--radius-lg);
        display: none;
    }

    .file-info.show {
        display: block;
    }

    /* ===========================
       CONFIGURATION PANEL
       =========================== */
    .config-panel {
        background: var(--gray-50);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        margin-top: 1.5rem;
    }

    .config-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .config-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .config-group label {
        font-weight: 500;
        color: var(--gray-700);
        font-size: 0.875rem;
    }

    .config-group select,
    .config-group input {
        padding: 0.75rem;
        border: 1px solid var(--gray-300);
        border-radius: var(--radius-md);
        font-family: inherit;
        font-size: 1rem;
        background: white;
        transition: border-color 0.2s;
    }

    .config-group select:focus,
    .config-group input:focus {
        outline: none;
        border-color: var(--primary-500);
        box-shadow: 0 0 0 3px var(--primary-100);
    }

    .config-actions {
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
    }

    /* ===========================
       PROGRESS & LOADING
       =========================== */
    .progress-container {
        margin-top: 2rem;
        display: none;
    }

    .progress-container.show {
        display: block;
    }

    .progress-bar {
        height: 0.5rem;
        background: var(--gray-200);
        border-radius: var(--radius-full);
        overflow: hidden;
        margin-bottom: 0.5rem;
    }

    .progress-fill {
        height: 100%;
        background: var(--primary-600);
        border-radius: var(--radius-full);
        transition: width 0.3s ease;
    }

    .progress-text {
        display: flex;
        justify-content: space-between;
        color: var(--gray-600);
        font-size: 0.875rem;
    }

    .loader {
        display: none;
        text-align: center;
        padding: 3rem;
    }

    .loader.show {
        display: block;
    }

    .spinner {
        width: 3rem;
        height: 3rem;
        border: 3px solid var(--gray-200);
        border-top: 3px solid var(--primary-600);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* ===========================
       SAVED QUIZZES
       =========================== */
    .quiz-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-top: 1.5rem;
    }

    .quiz-card {
        background: white;
        border: 1px solid var(--gray-200);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        transition: all 0.2s;
        cursor: pointer;
    }

    .quiz-card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
        border-color: var(--primary-300);
    }

    .quiz-card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
    }

    .quiz-card-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--gray-900);
        margin-right: 0.5rem;
    }

    .quiz-card-meta {
        display: flex;
        gap: 0.75rem;
        color: var(--gray-500);
        font-size: 0.875rem;
        margin-bottom: 1rem;
    }

    .quiz-card-stats {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid var(--gray-200);
    }

    .quiz-stat {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--gray-600);
        font-size: 0.875rem;
    }

    .quiz-actions {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
    }

    /* ===========================
       STUDY MODE
       =========================== */
    .study-content {
        margin-top: 1.5rem;
    }

    .chapter-nav {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--gray-200);
    }

    .chapter-btn {
        padding: 0.5rem 1rem;
        background: var(--gray-100);
        border: none;
        border-radius: var(--radius-md);
        font-weight: 500;
        color: var(--gray-700);
        cursor: pointer;
        transition: all 0.2s;
    }

    .chapter-btn:hover {
        background: var(--gray-200);
    }

    .chapter-btn.active {
        background: var(--primary-600);
        color: white;
    }

    .chapter-content {
        display: none;
        line-height: 1.6;
    }

    .chapter-content.active {
        display: block;
    }

    .chapter-content h2 {
        margin-bottom: 1rem;
        color: var(--gray-900);
    }

    .chapter-content p {
        margin-bottom: 1rem;
        color: var(--gray-700);
    }

    .chapter-content ul, .chapter-content ol {
        margin-left: 1.5rem;
        margin-bottom: 1rem;
    }

    /* ===========================
       QUIZ MODE
       =========================== */
    .quiz-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--gray-200);
    }

    .quiz-progress {
        display: flex;
        align-items: center;
        gap: 1rem;
        font-size: 0.875rem;
        color: var(--gray-600);
    }

    .question-navigator {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
        gap: 0.5rem;
        margin-bottom: 2rem;
    }

    .question-dot {
        width: 40px;
        height: 40px;
        border-radius: var(--radius-md);
        background: var(--gray-100);
        border: 2px solid var(--gray-200);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: var(--gray-700);
        cursor: pointer;
        transition: all 0.2s;
    }

    .question-dot:hover {
        border-color: var(--primary-500);
        background: var(--primary-50);
    }

    .question-dot.active {
        background: var(--primary-600);
        color: white;
        border-color: var(--primary-600);
    }

    .question-dot.answered {
        background: var(--success-50);
        border-color: var(--success-500);
        color: var(--success-600);
    }

    .question-dot.correct {
        background: var(--success-500);
        border-color: var(--success-600);
        color: white;
    }

    .question-dot.incorrect {
        background: var(--danger-500);
        border-color: var(--danger-600);
        color: white;
    }

    .question-container {
        margin-bottom: 2rem;
    }

    .question-text {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--gray-900);
        margin-bottom: 1.5rem;
        line-height: 1.4;
    }

    .options-grid {
        display: grid;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
    }

    .option {
        padding: 1rem 1.25rem;
        background: var(--gray-50);
        border: 2px solid var(--gray-200);
        border-radius: var(--radius-lg);
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .option:hover {
        border-color: var(--primary-500);
        background: var(--primary-50);
    }

    .option.selected {
        border-color: var(--primary-600);
        background: var(--primary-100);
    }

    .option.correct {
        border-color: var(--success-500);
        background: var(--success-50);
    }

    .option.incorrect {
        border-color: var(--danger-500);
        background: var(--danger-50);
    }

    .option.disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .option-letter {
        width: 36px;
        height: 36px;
        border-radius: var(--radius-md);
        background: white;
        border: 1px solid var(--gray-300);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: var(--gray-700);
        flex-shrink: 0;
    }

    .option.selected .option-letter {
        background: var(--primary-600);
        color: white;
        border-color: var(--primary-600);
    }

    .quiz-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 2rem;
        padding-top: 1.5rem;
        border-top: 1px solid var(--gray-200);
    }

    .navigation-buttons {
        display: flex;
        gap: 0.75rem;
    }

    /* ===========================
       RESULTS MODE
       =========================== */
    .results-summary {
        background: var(--gray-50);
        border-radius: var(--radius-lg);
        padding: 2rem;
        margin-bottom: 2rem;
    }

    .results-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        text-align: center;
    }

    .stat-value {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--primary-600);
        line-height: 1;
        margin-bottom: 0.5rem;
    }

    .stat-label {
        font-size: 0.875rem;
        color: var(--gray-600);
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .results-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .result-item {
        padding: 1.5rem;
        background: white;
        border-radius: var(--radius-lg);
        border: 1px solid var(--gray-200);
    }

    .result-item.correct {
        border-left: 4px solid var(--success-500);
    }

    .result-item.incorrect {
        border-left: 4px solid var(--danger-500);
    }

    .result-question {
        font-weight: 600;
        margin-bottom: 0.75rem;
        color: var(--gray-900);
    }

    .result-answer {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
        color: var(--gray-600);
    }

    .result-explanation {
        margin-top: 0.75rem;
        padding: 0.75rem;
        background: var(--gray-50);
        border-radius: var(--radius-md);
        font-size: 0.875rem;
        color: var(--gray-700);
    }

    /* ===========================
       BUTTONS
       =========================== */
    .btn {
        padding: 0.75rem 1.5rem;
        border-radius: var(--radius-lg);
        font-weight: 500;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
    }

    .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .btn-sm {
        padding: 0.5rem 1rem;
        font-size: 0.75rem;
    }

    .btn-primary {
        background: var(--primary-600);
        color: white;
    }

    .btn-primary:hover:not(:disabled) {
        background: var(--primary-700);
        transform: translateY(-1px);
    }

    .btn-secondary {
        background: var(--gray-100);
        color: var(--gray-700);
    }

    .btn-secondary:hover:not(:disabled) {
        background: var(--gray-200);
    }

    .btn-success {
        background: var(--success-600);
        color: white;
    }

    .btn-danger {
        background: var(--danger-600);
        color: white;
    }

    .btn-danger:hover:not(:disabled) {
        background: var(--danger-700);
    }

    .btn-outline {
        background: transparent;
        border: 2px solid var(--gray-300);
        color: var(--gray-700);
    }

    .btn-outline:hover:not(:disabled) {
        border-color: var(--primary-500);
        color: var(--primary-600);
    }

    /* ===========================
       TOAST NOTIFICATIONS
       =========================== */
    .toast-container {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        max-width: 400px;
    }

    .toast {
        background: white;
        border-radius: var(--radius-lg);
        padding: 1rem 1.25rem;
        box-shadow: var(--shadow-lg);
        border-left: 4px solid var(--primary-500);
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        animation: slideIn 0.3s ease-out;
        transform: translateX(0);
    }

    .toast.success {
        border-left-color: var(--success-500);
    }

    .toast.warning {
        border-left-color: var(--warning-500);
    }

    .toast.error {
        border-left-color: var(--danger-500);
    }

    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    .toast-content {
        flex: 1;
    }

    .toast-title {
        font-weight: 600;
        margin-bottom: 0.25rem;
        color: var(--gray-900);
    }

    .toast-message {
        font-size: 0.875rem;
        color: var(--gray-600);
    }

    .toast-close {
        background: none;
        border: none;
        color: var(--gray-400);
        cursor: pointer;
        padding: 0.25rem;
        margin-left: 0.5rem;
        flex-shrink: 0;
    }

    .toast-close:hover {
        color: var(--gray-600);
    }

    /* ===========================
       MODALS
       =========================== */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        padding: 1rem;
    }

    .modal-overlay.show {
        display: flex;
    }

    .modal {
        background: white;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-xl);
        max-width: 500px;
        width: 100%;
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-header {
        padding: 1.5rem 1.5rem 1rem;
        border-bottom: 1px solid var(--gray-200);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-body {
        padding: 1.5rem;
    }

    .modal-footer {
        padding: 1rem 1.5rem 1.5rem;
        border-top: 1px solid var(--gray-200);
        display: flex;
        justify-content: flex-end;
        gap: 0.75rem;
    }

    /* ===========================
       RESPONSIVE DESIGN
       =========================== */
    @media (max-width: 768px) {
        .header-content {
            flex-direction: column;
            align-items: stretch;
            gap: 1rem;
        }

        .header-actions {
            justify-content: center;
        }

        .main-content {
            padding: 1rem;
        }

        .card {
            padding: 1.25rem;
        }

        .tabs {
            gap: 0.25rem;
        }

        .tab {
            padding: 0.625rem 1rem;
            font-size: 0.875rem;
        }

        .config-grid {
            grid-template-columns: 1fr;
        }

        .quiz-grid {
            grid-template-columns: 1fr;
        }

        .question-dot {
            width: 36px;
            height: 36px;
        }

        .quiz-controls {
            flex-direction: column;
            gap: 1rem;
            align-items: stretch;
        }

        .navigation-buttons {
            justify-content: space-between;
        }

        .toast-container {
            left: 1rem;
            right: 1rem;
            max-width: none;
        }
    }

    @media (max-width: 480px) {
        .upload-area {
            padding: 2rem 1rem;
        }

        .upload-icon {
            font-size: 2.5rem;
        }

        .results-stats {
            grid-template-columns: 1fr;
        }

        .modal {
            margin: 1rem;
        }
    }

    /* ===========================
       UTILITY CLASSES
       =========================== */
    .text-sm {
        font-size: 0.875rem;
    }

    .text-xs {
        font-size: 0.75rem;
    }

    .text-center {
        text-align: center;
    }

    .text-muted {
        color: var(--gray-500);
    }

    .mb-1 { margin-bottom: 0.25rem; }
    .mb-2 { margin-bottom: 0.5rem; }
    .mb-3 { margin-bottom: 0.75rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mb-6 { margin-bottom: 1.5rem; }
    .mb-8 { margin-bottom: 2rem; }

    .mt-1 { margin-top: 0.25rem; }
    .mt-2 { margin-top: 0.5rem; }
    .mt-3 { margin-top: 0.75rem; }
    .mt-4 { margin-top: 1rem; }
    .mt-6 { margin-top: 1.5rem; }

    .flex {
        display: flex;
    }

    .flex-col {
        flex-direction: column;
    }

    .items-center {
        align-items: center;
    }

    .justify-between {
        justify-content: space-between;
    }

    .gap-2 { gap: 0.5rem; }
    .gap-3 { gap: 0.75rem; }
    .gap-4 { gap: 1rem; }

    .w-full {
        width: 100%;
    }

    .hidden {
        display: none;
    }
</style>
</head>
<body>
<div class="app-container">
    <!-- Toast Notifications Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Header -->
    <header class="app-header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">Q</div>
                <div class="logo-text">
                    <h1>PDF Quiz Generator</h1>
                    <p>Intelligent content extraction & learning</p>
                </div>
            </div>
            <div class="header-actions">
                <div class="flex items-center gap-4">
                    <span class="text-sm text-muted" id="currentTabLabel">Upload PDF</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Tabs Navigation -->
        <div class="tabs" id="tabNav">
            <button class="tab active" data-tab="upload">
                <i class="fas fa-file-upload"></i> Upload PDF
            </button>
            <button class="tab" data-tab="configure">
                <i class="fas fa-cog"></i> Configure Quiz
            </button>
            <button class="tab" data-tab="study">
                <i class="fas fa-book-open"></i> Study Material
            </button>
            <button class="tab" data-tab="quiz">
                <i class="fas fa-question-circle"></i> Take Quiz
            </button>
            <button class="tab" data-tab="results">
                <i class="fas fa-chart-bar"></i> Results
            </button>
            <button class="tab" data-tab="saved">
                <i class="fas fa-save"></i> Saved Quizzes
            </button>
        </div>

        <!-- Upload Tab -->
        <div class="tab-content active" id="uploadTab">
            <div class="card">
                <div class="card-header">
                    <h2>Upload PDF Document</h2>
                    <p class="text-muted mt-2">Upload your educational PDF to generate intelligent quiz questions</p>
                </div>
                
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <div class="upload-text">
                        <h3>Drop PDF here or click to browse</h3>
                        <p>Supported: Textbooks, articles, lecture notes, study materials. We'll extract meaningful content and generate appropriate questions.</p>
                    </div>
                    <input type="file" id="pdfFileInput" class="file-input" accept=".pdf">
                    <button class="upload-btn" id="browseBtn">
                        <i class="fas fa-folder-open"></i> Browse Files
                    </button>
                </div>

                <div class="file-info" id="fileInfo">
                    <div class="flex justify-between items-center">
                        <div>
                            <strong id="fileName">No file selected</strong>
                            <p class="text-sm text-muted mt-1" id="fileSize">-</p>
                        </div>
                        <button class="btn btn-secondary btn-sm" id="clearFileBtn">
                            <i class="fas fa-times"></i> Clear
                        </button>
                    </div>
                </div>

                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div class="progress-text">
                        <span id="progressStatus">Ready</span>
                        <span id="progressPercent">0%</span>
                    </div>
                </div>

                <div class="loader" id="loader">
                    <div class="spinner"></div>
                    <p class="mt-4 text-muted" id="loaderText">Processing PDF...</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>How It Works</h3>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="flex flex-col items-center text-center">
                        <div class="w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center mb-3">
                            <i class="fas fa-file-import text-primary-600"></i>
                        </div>
                        <h4 class="mb-2">1. Upload PDF</h4>
                        <p class="text-sm text-muted">Upload any educational PDF document with text content</p>
                    </div>
                    <div class="flex flex-col items-center text-center">
                        <div class="w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center mb-3">
                            <i class="fas fa-brain text-primary-600"></i>
                        </div>
                        <h4 class="mb-2">2. Intelligent Analysis</h4>
                        <p class="text-sm text-muted">We extract key concepts, definitions, and important information</p>
                    </div>
                    <div class="flex flex-col items-center text-center">
                        <div class="w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center mb-3">
                            <i class="fas fa-graduation-cap text-primary-600"></i>
                        </div>
                        <h4 class="mb-2">3. Learn & Quiz</h4>
                        <p class="text-sm text-muted">Study the material and test your knowledge with relevant questions</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configure Tab -->
        <div class="tab-content" id="configureTab">
            <div class="card">
                <div class="card-header">
                    <h2>Configure Quiz Generation</h2>
                    <p class="text-muted mt-2">Customize how questions are generated from your PDF content</p>
                </div>

                <div class="config-panel">
                    <div class="config-grid">
                        <div class="config-group">
                            <label for="numQuestions">
                                <i class="fas fa-question-circle mr-1"></i>
                                Number of Questions
                            </label>
                            <select id="numQuestions" class="w-full">
                                <option value="10">10 Questions (Quick Quiz)</option>
                                <option value="20" selected>20 Questions (Standard)</option>
                                <option value="30">30 Questions (Comprehensive)</option>
                                <option value="40">40 Questions (In-depth)</option>
                                <option value="50">50 Questions (Complete Review)</option>
                            </select>
                            <p class="text-xs text-muted mt-1">More questions = more comprehensive coverage</p>
                        </div>

                        <div class="config-group">
                            <label for="difficulty">
                                <i class="fas fa-chart-line mr-1"></i>
                                Difficulty Level
                            </label>
                            <select id="difficulty" class="w-full">
                                <option value="basic">Basic (Definitions & Facts)</option>
                                <option value="intermediate" selected>Intermediate (Understanding)</option>
                                <option value="advanced">Advanced (Application & Analysis)</option>
                                <option value="mixed">Mixed (All levels)</option>
                            </select>
                            <p class="text-xs text-muted mt-1">Adjusts question complexity and depth</p>
                        </div>

                        <div class="config-group">
                            <label for="questionTypes">
                                <i class="fas fa-clipboard-list mr-1"></i>
                                Question Types
                            </label>
                            <select id="questionTypes" class="w-full">
                                <option value="all">All Types (Balanced)</option>
                                <option value="definition" selected>Definitions & Key Terms</option>
                                <option value="comprehension">Comprehension Questions</option>
                                <option value="application">Application Questions</option>
                                <option value="analysis">Analysis & Critical Thinking</option>
                            </select>
                            <p class="text-xs text-muted mt-1">Focus on specific types of questions</p>
                        </div>
                    </div>

                    <div class="config-grid mt-6">
                        <div class="config-group">
                            <label for="focusAreas">
                                <i class="fas fa-bullseye mr-1"></i>
                                Focus Areas (Keywords)
                            </label>
                            <input type="text" id="focusAreas" 
                                   placeholder="e.g., biology, chemistry, history, economics"
                                   class="w-full">
                            <p class="text-xs text-muted mt-1">Leave empty to analyze all content</p>
                        </div>

                        <div class="config-group">
                            <label for="timeLimit">
                                <i class="fas fa-clock mr-1"></i>
                                Time Limit (Optional)
                            </label>
                            <select id="timeLimit" class="w-full">
                                <option value="0">No time limit</option>
                                <option value="300">5 minutes</option>
                                <option value="600">10 minutes</option>
                                <option value="900">15 minutes</option>
                                <option value="1800">30 minutes</option>
                                <option value="3600">60 minutes</option>
                            </select>
                        </div>

                        <div class="config-group">
                            <label for="passingScore">
                                <i class="fas fa-trophy mr-1"></i>
                                Passing Score (%)
                            </label>
                            <select id="passingScore" class="w-full">
                                <option value="60">60% (Minimum)</option>
                                <option value="70" selected>70% (Standard)</option>
                                <option value="80">80% (Good)</option>
                                <option value="90">90% (Excellent)</option>
                                <option value="100">100% (Mastery)</option>
                            </select>
                        </div>
                    </div>

                    <div class="config-actions mt-6">
                        <button class="btn btn-secondary" id="resetConfigBtn">
                            <i class="fas fa-undo"></i> Reset to Defaults
                        </button>
                        <button class="btn btn-primary" id="generateQuizBtn">
                            <i class="fas fa-magic"></i> Generate Intelligent Questions
                        </button>
                    </div>
                </div>

                <div class="mt-6 p-4 bg-warning-50 border border-warning-200 rounded-lg">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-lightbulb text-warning-600 mt-1"></i>
                        <div>
                            <h4 class="text-warning-800 mb-1">Intelligent Question Generation</h4>
                            <p class="text-sm text-warning-700">
                                Our system analyzes your PDF to identify key concepts, important definitions, 
                                and critical information. Questions are generated based on actual content 
                                from your document, ensuring relevance and accuracy.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Study Tab -->
        <div class="tab-content" id="studyTab">
            <div class="card">
                <div class="card-header">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2>Study Material</h2>
                            <p class="text-muted mt-1">Extracted and organized content from your PDF</p>
                        </div>
                        <button class="btn btn-outline" id="printStudyBtn">
                            <i class="fas fa-print"></i> Print
                        </button>
                    </div>
                </div>

                <div class="study-content">
                    <div class="chapter-nav" id="chapterNav"></div>
                    <div id="chapterContent"></div>
                </div>

                <div class="mt-6 p-4 bg-primary-50 border border-primary-200 rounded-lg">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-graduation-cap text-primary-600 mt-1"></i>
                        <div>
                            <h4 class="text-primary-800 mb-1">Study Tips</h4>
                            <ul class="text-sm text-primary-700 space-y-1">
                                <li>• Review each chapter before attempting the quiz</li>
                                <li>• Take notes on key concepts and definitions</li>
                                <li>• Focus on understanding rather than memorization</li>
                                <li>• Use the quiz to identify areas needing more study</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quiz Tab -->
        <div class="tab-content" id="quizTab">
            <div class="card">
                <div class="quiz-header">
                    <div>
                        <h2>Quiz</h2>
                        <p class="text-sm text-muted mt-1" id="quizInfo">Answer questions based on the study material</p>
                    </div>
                    <div class="quiz-progress">
                        <span id="currentQuestion">1</span>
                        <span class="text-muted">of</span>
                        <span id="totalQuestions">0</span>
                        <span class="text-muted" id="timerDisplay">No time limit</span>
                    </div>
                </div>

                <div class="question-navigator" id="questionNav"></div>

                <div class="question-container">
                    <div class="question-text" id="questionText">
                        Please generate questions first from the Configure tab.
                    </div>

                    <div class="options-grid" id="optionsGrid"></div>

                    <div class="flex items-center justify-between mt-6">
                        <div class="flex items-center gap-3">
                            <button class="btn btn-outline" id="hintBtn">
                                <i class="fas fa-lightbulb"></i> Show Hint
                            </button>
                            <div class="text-sm text-muted" id="hintText" style="display: none;"></div>
                        </div>
                        <div class="flex items-center gap-3">
                            <button class="btn btn-outline" id="flagBtn">
                                <i class="far fa-flag"></i> Flag Question
                            </button>
                            <button class="btn btn-primary" id="submitAnswerBtn" disabled>
                                Submit Answer
                            </button>
                        </div>
                    </div>
                </div>

                <div class="quiz-controls">
                    <div class="navigation-buttons">
                        <button class="btn btn-secondary" id="prevBtn" disabled>
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button class="btn btn-secondary" id="nextBtn" disabled>
                            Next <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                    <div>
                        <button class="btn btn-success" id="submitQuizBtn" disabled>
                            <i class="fas fa-paper-plane"></i> Submit Quiz
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Tab -->
        <div class="tab-content" id="resultsTab">
            <div class="card">
                <div class="card-header">
                    <h2>Quiz Results</h2>
                    <p class="text-muted mt-1">Review your performance and learn from mistakes</p>
                </div>

                <div class="results-summary" id="resultsSummary">
                    <div class="results-stats">
                        <div>
                            <div class="stat-value" id="scorePercentage">0%</div>
                            <div class="stat-label">Score</div>
                        </div>
                        <div>
                            <div class="stat-value" id="correctCount">0</div>
                            <div class="stat-label">Correct Answers</div>
                        </div>
                        <div>
                            <div class="stat-value" id="timeTaken">0s</div>
                            <div class="stat-label">Time Taken</div>
                        </div>
                        <div>
                            <div class="stat-value" id="performance">Needs Work</div>
                            <div class="stat-label">Performance</div>
                        </div>
                    </div>
                </div>

                <div class="results-list" id="resultsList"></div>

                <div class="flex gap-3 mt-6">
                    <button class="btn btn-secondary" id="reviewBtn">
                        <i class="fas fa-redo"></i> Review Questions
                    </button>
                    <button class="btn btn-primary" id="retryBtn">
                        <i class="fas fa-sync-alt"></i> Retry Quiz
                    </button>
                    <button class="btn btn-success" id="saveResultsBtn">
                        <i class="fas fa-save"></i> Save Results
                    </button>
                </div>
            </div>
        </div>

        <!-- Saved Quizzes Tab -->
        <div class="tab-content" id="savedTab">
            <div class="card">
                <div class="card-header">
                    <div class="flex justify-between items-center">
                        <div>
                            <h2>Saved Quizzes</h2>
                            <p class="text-muted mt-1">Access your previously created quizzes</p>
                        </div>
                        <button class="btn btn-outline" id="refreshSavedBtn">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                </div>

                <div class="quiz-grid" id="savedQuizzesGrid">
                    <div class="text-center py-12">
                        <i class="fas fa-inbox text-4xl text-gray-300 mb-4"></i>
                        <h3 class="text-gray-600 mb-2">No Saved Quizzes</h3>
                        <p class="text-gray-500">Generate and save your first quiz to see it here.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Save Quiz Modal -->
<div class="modal-overlay" id="saveModal">
    <div class="modal">
        <div class="modal-header">
            <h3>Save Quiz</h3>
            <button class="btn btn-outline btn-sm" id="closeSaveModal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="config-group mb-4">
                <label for="quizTitle">Quiz Title</label>
                <input type="text" id="quizTitle" class="w-full" 
                       placeholder="Enter a descriptive title">
            </div>
            <div class="config-group mb-4">
                <label for="quizDescription">Description (Optional)</label>
                <textarea id="quizDescription" class="w-full" rows="3"
                          placeholder="Brief description of this quiz"></textarea>
            </div>
            <div class="config-group mb-6">
                <label for="saveCategory">Category</label>
                <select id="saveCategory" class="w-full">
                    <option value="General">General</option>
                    <option value="Education">Education</option>
                    <option value="Science">Science</option>
                    <option value="Mathematics">Mathematics</option>
                    <option value="History">History</option>
                    <option value="Literature">Literature</option>
                    <option value="Technology">Technology</option>
                    <option value="Business">Business</option>
                    <option value="Other">Other</option>
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="cancelSaveBtn">Cancel</button>
            <button class="btn btn-primary" id="confirmSaveBtn">Save Quiz</button>
        </div>
    </div>
</div>

<script>
/* ===========================
   APPLICATION STATE
   =========================== */
const AppState = {
    // PDF Data
    pdfDoc: null,
    pdfText: '',
    pdfFileName: '',
    pdfFileSize: 0,
    
    // Quiz Configuration
    config: {
        numQuestions: 20,
        difficulty: 'intermediate',
        questionTypes: 'definition',
        focusAreas: '',
        timeLimit: 0,
        passingScore: 70
    },
    
    // Generated Content
    chapters: [],
    questions: [],
    extractedConcepts: [],
    
    // Current Quiz State
    currentQuiz: {
        questions: [],
        userAnswers: {},
        currentIndex: 0,
        score: 0,
        correctCount: 0,
        startTime: null,
        endTime: null,
        flaggedQuestions: new Set()
    },
    
    // Saved Quizzes
    savedQuizzes: [],
    
    // UI State
    currentTab: 'upload',
    isProcessing: false
};

/* ===========================
   UTILITY FUNCTIONS
   =========================== */
function showToast(title, message, type = 'info', duration = 5000) {
    const toastContainer = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    
    const toastId = `toast-${Date.now()}`;
    toast.id = toastId;
    
    toast.innerHTML = `
        <div class="toast-content">
            <div class="toast-title">${title}</div>
            <div class="toast-message">${message}</div>
        </div>
        <button class="toast-close" onclick="document.getElementById('${toastId}').remove()">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    toastContainer.appendChild(toast);
    
    // Auto-remove after duration
    setTimeout(() => {
        const existingToast = document.getElementById(toastId);
        if (existingToast) {
            existingToast.style.transform = 'translateX(100%)';
            existingToast.style.opacity = '0';
            setTimeout(() => existingToast.remove(), 300);
        }
    }, duration);
}

function updateProgress(status, percent) {
    const progressFill = document.getElementById('progressFill');
    const progressStatus = document.getElementById('progressStatus');
    const progressPercent = document.getElementById('progressPercent');
    const progressContainer = document.getElementById('progressContainer');
    
    progressFill.style.width = `${percent}%`;
    progressStatus.textContent = status;
    progressPercent.textContent = `${Math.round(percent)}%`;
    progressContainer.classList.add('show');
}

function showLoader(show, text = 'Processing...') {
    const loader = document.getElementById('loader');
    const loaderText = document.getElementById('loaderText');
    
    if (show) {
        loaderText.textContent = text;
        loader.classList.add('show');
    } else {
        loader.classList.remove('show');
    }
}

function setActiveTab(tabId) {
    // Update UI
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.tab === tabId);
    });
    
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.toggle('active', content.id === `${tabId}Tab`);
    });
    
    // Update current tab label
    const tabLabels = {
        'upload': 'Upload PDF',
        'configure': 'Configure Quiz',
        'study': 'Study Material',
        'quiz': 'Take Quiz',
        'results': 'Quiz Results',
        'saved': 'Saved Quizzes'
    };
    document.getElementById('currentTabLabel').textContent = tabLabels[tabId];
    
    // Update state
    AppState.currentTab = tabId;
}

function showModal(modalId, show = true) {
    const modal = document.getElementById(modalId);
    if (show) {
        modal.classList.add('show');
    } else {
        modal.classList.remove('show');
    }
}

/* ===========================
   PDF PROCESSING
   =========================== */
async function processPDF(file) {
    if (!file || file.type !== 'application/pdf') {
        showToast('Error', 'Please select a valid PDF file', 'error');
        return;
    }
    
    AppState.pdfFileName = file.name;
    AppState.pdfFileSize = (file.size / (1024 * 1024)).toFixed(2);
    
    // Update file info display
    document.getElementById('fileName').textContent = file.name;
    document.getElementById('fileSize').textContent = `${AppState.pdfFileSize} MB`;
    document.getElementById('fileInfo').classList.add('show');
    
    showLoader(true, 'Loading PDF document...');
    updateProgress('Loading PDF', 10);
    
    try {
        // Load PDF with pdf.js
        const arrayBuffer = await file.arrayBuffer();
        const loadingTask = pdfjsLib.getDocument({ data: arrayBuffer });
        AppState.pdfDoc = await loadingTask.promise;
        
        updateProgress('Extracting text content', 30);
        showLoader(true, 'Extracting text content...');
        
        // Extract text from all pages
        let fullText = '';
        const totalPages = Math.min(AppState.pdfDoc.numPages, 50); // Limit to 50 pages
        
        for (let i = 1; i <= totalPages; i++) {
            const page = await AppState.pdfDoc.getPage(i);
            const textContent = await page.getTextContent();
            const pageText = textContent.items.map(item => item.str).join(' ');
            fullText += pageText + '\n\n';
            
            // Update progress
            const progress = 30 + ((i / totalPages) * 40);
            updateProgress(`Extracting page ${i} of ${totalPages}`, progress);
        }
        
        AppState.pdfText = fullText;
        
        updateProgress('Analyzing content', 80);
        showLoader(true, 'Analyzing document content...');
        
        // Extract key concepts and structure
        await extractKeyConcepts(fullText);
        
        updateProgress('Ready', 100);
        showLoader(false);
        
        // Auto-switch to configure tab
        setTimeout(() => {
            setActiveTab('configure');
            showToast('Success', 'PDF processed successfully! Configure your quiz settings.', 'success');
        }, 500);
        
    } catch (error) {
        console.error('PDF processing error:', error);
        showLoader(false);
        showToast('Error', 'Failed to process PDF. Please try another file.', 'error');
    }
}

/* ===========================
   INTELLIGENT CONTENT ANALYSIS
   =========================== */
async function extractKeyConcepts(text) {
    // Clean and normalize text
    const cleanText = text.replace(/\s+/g, ' ').trim();
    
    // Split into paragraphs
    const paragraphs = cleanText.split(/\n\s*\n/).filter(p => p.length > 100);
    
    // Extract sentences for analysis
    const sentences = extractSentences(cleanText);
    
    // 1. Extract definitions (look for patterns like "X is defined as", "X means", etc.)
    const definitions = extractDefinitions(sentences);
    
    // 2. Extract key terms (capitalized words, technical terms)
    const keyTerms = extractKeyTerms(cleanText);
    
    // 3. Extract important concepts (frequent nouns, subject-specific terms)
    const concepts = extractImportantConcepts(cleanText);
    
    // 4. Create chapters from major sections
    const chapters = createChaptersFromText(paragraphs);
    
    // Store extracted data
    AppState.extractedConcepts = {
        definitions,
        keyTerms,
        concepts,
        sentences
    };
    
    AppState.chapters = chapters;
    
    // Build study material UI
    buildStudyMaterial();
}

function extractSentences(text) {
    return text
        .replace(/\n/g, ' ')
        .match(/[^.!?]+[.!?]+/g)
        ?.map(s => s.trim())
        .filter(s => s.length > 20 && s.length < 300) || [];
}

function extractDefinitions(sentences) {
    const definitions = [];
    const definitionPatterns = [
        /([A-Z][A-Za-z\s]+)\s+(?:is|are)\s+(?:defined as|known as|called)\s+([^.!?]+)/i,
        /([A-Z][A-Za-z\s]+)\s+(?:refers to|means)\s+([^.!?]+)/i,
        /(?:The term|The concept of)\s+([A-Z][A-Za-z\s]+)\s+(?:is|are)\s+([^.!?]+)/i,
        /([A-Z][A-Za-z\s]+)\s+(?:can be described as|is characterized by)\s+([^.!?]+)/i
    ];
    
    sentences.forEach(sentence => {
        definitionPatterns.forEach(pattern => {
            const match = sentence.match(pattern);
            if (match) {
                const term = match[1].trim();
                const definition = match[2].trim();
                definitions.push({ term, definition, sentence });
            }
        });
    });
    
    return definitions;
}

function extractKeyTerms(text) {
    // Extract capitalized terms (potential proper nouns or key concepts)
    const capitalizedTerms = text.match(/[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*/g) || [];
    
    // Filter for terms that appear multiple times (likely important)
    const termFrequency = {};
    capitalizedTerms.forEach(term => {
        if (term.split(' ').length <= 4) { // Limit to reasonable length
            termFrequency[term] = (termFrequency[term] || 0) + 1;
        }
    });
    
    // Get most frequent terms
    return Object.entries(termFrequency)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 50)
        .map(([term]) => term);
}

function extractImportantConcepts(text) {
    // Extract nouns and noun phrases (simplified approach)
    const words = text.toLowerCase().match(/\b[a-z]{4,}\b/g) || [];
    
    // Count word frequencies
    const wordFreq = {};
    words.forEach(word => {
        // Skip common stop words
        const stopWords = ['that', 'with', 'this', 'from', 'have', 'which', 'their', 'what'];
        if (!stopWords.includes(word)) {
            wordFreq[word] = (wordFreq[word] || 0) + 1;
        }
    });
    
    // Get most frequent meaningful words
    return Object.entries(wordFreq)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 100)
        .map(([word]) => word.charAt(0).toUpperCase() + word.slice(1));
}

function createChaptersFromText(paragraphs) {
    const chapters = [];
    const maxChapters = 8;
    const minParagraphsPerChapter = 2;
    
    if (paragraphs.length <= minParagraphsPerChapter * 2) {
        // Small document - create single chapter
        chapters.push({
            id: 'chapter-1',
            title: 'Main Content',
            content: paragraphs.join('\n\n')
        });
        return chapters;
    }
    
    // Calculate chunk size
    const chunkSize = Math.max(
        minParagraphsPerChapter,
        Math.ceil(paragraphs.length / maxChapters)
    );
    
    // Create chapters
    for (let i = 0; i < paragraphs.length; i += chunkSize) {
        const chapterNum = Math.floor(i / chunkSize) + 1;
        const chapterParagraphs = paragraphs.slice(i, i + chunkSize);
        
        // Extract a title from the first sentence
        const firstParagraph = chapterParagraphs[0];
        const firstSentence = firstParagraph.split('.')[0];
        let title = `Chapter ${chapterNum}`;
        
        // Try to create meaningful title from first sentence
        if (firstSentence.length > 20 && firstSentence.length < 100) {
            title = firstSentence.substring(0, 60) + (firstSentence.length > 60 ? '...' : '');
        }
        
        chapters.push({
            id: `chapter-${chapterNum}`,
            title: title,
            content: chapterParagraphs.join('\n\n')
        });
    }
    
    return chapters;
}

/* ===========================
   INTELLIGENT QUESTION GENERATION
   =========================== */
async function generateQuestions() {
    if (!AppState.pdfText) {
        showToast('Error', 'Please upload a PDF first', 'error');
        setActiveTab('upload');
        return;
    }
    
    showLoader(true, 'Generating intelligent questions...');
    
    try {
        // Get configuration
        const numQuestions = parseInt(document.getElementById('numQuestions').value);
        const difficulty = document.getElementById('difficulty').value;
        const questionTypes = document.getElementById('questionTypes').value;
        const focusAreas = document.getElementById('focusAreas').value.toLowerCase();
        
        // Generate questions based on configuration
        const questions = [];
        
        // 1. Definition questions (always included as they're most reliable)
        const definitionQuestions = generateDefinitionQuestions();
        questions.push(...definitionQuestions.slice(0, Math.ceil(numQuestions * 0.4)));
        
        // 2. Comprehension questions
        const comprehensionQuestions = generateComprehensionQuestions();
        questions.push(...comprehensionQuestions.slice(0, Math.ceil(numQuestions * 0.3)));
        
        // 3. Application questions (for intermediate/advanced)
        if (difficulty !== 'basic') {
            const applicationQuestions = generateApplicationQuestions();
            questions.push(...applicationQuestions.slice(0, Math.ceil(numQuestions * 0.2)));
        }
        
        // 4. Analysis questions (for advanced)
        if (difficulty === 'advanced' || difficulty === 'mixed') {
            const analysisQuestions = generateAnalysisQuestions();
            questions.push(...analysisQuestions.slice(0, Math.ceil(numQuestions * 0.1)));
        }
    
        // Filter by focus areas if specified
        let filteredQuestions = questions;
        if (focusAreas.trim()) {
            const focusKeywords = focusAreas.split(',').map(k => k.trim());
            filteredQuestions = questions.filter(q => 
                focusKeywords.some(keyword => 
                    q.question.toLowerCase().includes(keyword) ||
                    (q.context && q.context.toLowerCase().includes(keyword))
                )
            );
            
            if (filteredQuestions.length < numQuestions * 0.5) {
                showToast('Warning', 'Limited questions found for focus areas. Including additional questions.', 'warning');
                // Add some general questions to reach minimum
                const needed = numQuestions - filteredQuestions.length;
                const additional = questions
                    .filter(q => !filteredQuestions.includes(q))
                    .slice(0, needed);
                filteredQuestions.push(...additional);
            }
        }
        
        // Ensure we have enough questions
        if (filteredQuestions.length < numQuestions) {
            showToast('Info', `Generated ${filteredQuestions.length} relevant questions from your PDF.`, 'info');
        } else {
            // Trim to requested number
            filteredQuestions = filteredQuestions.slice(0, numQuestions);
        }
        
        // Shuffle questions
        filteredQuestions = filteredQuestions.sort(() => Math.random() - 0.5);
        
        // Store questions
        AppState.questions = filteredQuestions;
        AppState.currentQuiz.questions = [...filteredQuestions];
        AppState.currentQuiz.currentIndex = 0;
        AppState.currentQuiz.userAnswers = {};
        AppState.currentQuiz.score = 0;
        AppState.currentQuiz.correctCount = 0;
        
        showLoader(false);
        
        // Update quiz UI
        updateQuizUI();
        setActiveTab('quiz');
        
        showToast('Success', `Generated ${filteredQuestions.length} intelligent questions from your PDF!`, 'success');
        
    } catch (error) {
        console.error('Question generation error:', error);
        showLoader(false);
        showToast('Error', 'Failed to generate questions. Please try different settings.', 'error');
    }
}

function generateDefinitionQuestions() {
    const questions = [];
    const definitions = AppState.extractedConcepts.definitions;
    
    definitions.forEach((def, index) => {
        if (index < 20) { // Limit definition questions
            // Create wrong answers from other definitions
            const wrongDefinitions = definitions
                .filter((_, i) => i !== index)
                .slice(0, 3)
                .map(d => d.definition);
            
            // If not enough wrong definitions, create plausible alternatives
            while (wrongDefinitions.length < 3) {
                wrongDefinitions.push(`A different concept related to ${def.term}`);
                wrongDefinitions.push(`The opposite of what ${def.term} means`);
                wrongDefinitions.push(`A common misconception about ${def.term}`);
            }
            
            questions.push({
                id: `def-${index}`,
                type: 'definition',
                difficulty: 'basic',
                question: `What is the definition of "${def.term}"?`,
                options: [
                    def.definition,
                    ...wrongDefinitions.slice(0, 3)
                ].sort(() => Math.random() - 0.5),
                correctAnswer: 0,
                explanation: `Based on the text: "${def.sentence.substring(0, 150)}..."`,
                context: def.sentence,
                source: 'definition_extraction'
            });
        }
    });
    
    return questions;
}

function generateComprehensionQuestions() {
    const questions = [];
    const sentences = AppState.extractedConcepts.sentences;
    const keyTerms = AppState.extractedConcepts.keyTerms;
    
    // Use sentences that contain key terms
    const relevantSentences = sentences.filter(sentence =>
        keyTerms.some(term => sentence.includes(term))
    ).slice(0, 30); // Limit analysis
    
    relevantSentences.forEach((sentence, index) => {
        // Extract main subject
        const words = sentence.split(' ');
        const subject = words.find(w => 
            keyTerms.some(term => term.toLowerCase().includes(w.toLowerCase()) || w.toLowerCase().includes(term.toLowerCase()))
        ) || words[0];
        
        // Create comprehension question
        const questionText = `Based on the following statement: "${sentence.substring(0, 100)}${sentence.length > 100 ? '...' : ''}" What is the main point?`;
        
        // Create plausible wrong answers
        const wrongAnswers = [
            `It discusses a different aspect of ${subject}`,
            `It contradicts common knowledge about ${subject}`,
            `It introduces an unrelated concept`,
            `It focuses on historical context rather than current understanding`
        ].sort(() => Math.random() - 0.5).slice(0, 3);
        
        // Create correct answer based on sentence content
        const correctAnswer = `It explains ${subject} ${sentence.includes('because') ? 'by providing reasons' : 'through description'}`;
        
        questions.push({
            id: `comp-${index}`,
            type: 'comprehension',
            difficulty: 'intermediate',
            question: questionText,
            options: [
                correctAnswer,
                ...wrongAnswers
            ].sort(() => Math.random() - 0.5),
            correctAnswer: 0,
            explanation: `The complete statement is: "${sentence}"`,
            context: sentence,
            source: 'comprehension_analysis'
        });
    });
    
    return questions;
}

function generateApplicationQuestions() {
    const questions = [];
    const concepts = AppState.extractedConcepts.concepts;
    const sentences = AppState.extractedConcepts.sentences;
    
    // Find sentences with application-related words
    const applicationWords = ['apply', 'use', 'implement', 'practice', 'method', 'technique', 'process'];
    const applicationSentences = sentences.filter(sentence =>
        applicationWords.some(word => sentence.toLowerCase().includes(word))
    ).slice(0, 20);
    
    applicationSentences.forEach((sentence, index) => {
        const mainConcept = concepts.find(concept => 
            sentence.toLowerCase().includes(concept.toLowerCase())
        ) || concepts[0];
        
        questions.push({
            id: `app-${index}`,
            type: 'application',
            difficulty: 'intermediate',
            question: `How would you apply the concept of ${mainConcept} based on the text?`,
            options: [
                `By following the methods described in the text`,
                `Through practical applications mentioned`,
                `Using the theoretical framework provided`,
                `All of the above`
            ],
            correctAnswer: 3, // "All of the above" is often correct for application questions
            explanation: `The text discusses applications related to ${mainConcept}`,
            context: sentence,
            source: 'application_analysis'
        });
    });
    
    return questions;
}

function generateAnalysisQuestions() {
    const questions = [];
    const keyTerms = AppState.extractedConcepts.keyTerms.slice(0, 10);
    
    keyTerms.forEach((term, index) => {
        questions.push({
            id: `ana-${index}`,
            type: 'analysis',
            difficulty: 'advanced',
            question: `Analyze the significance of ${term} based on the text. Which statement is most accurate?`,
            options: [
                `${term} plays a crucial role as described in the text`,
                `${term} is mentioned but has minor importance`,
                `${term} contradicts other concepts in the text`,
                `The text doesn't provide enough information about ${term}`
            ],
            correctAnswer: 0, // Most likely the term is significant if it's a key term
            explanation: `${term} is identified as a key concept in the text`,
            context: 'Key concept analysis',
            source: 'concept_analysis'
        });
    });
    
    return questions;
}

/* ===========================
   UI BUILDING FUNCTIONS
   =========================== */
function buildStudyMaterial() {
    const chapterNav = document.getElementById('chapterNav');
    const chapterContent = document.getElementById('chapterContent');
    
    // Clear existing content
    chapterNav.innerHTML = '';
    chapterContent.innerHTML = '';
    
    if (AppState.chapters.length === 0) {
        chapterContent.innerHTML = `
            <div class="text-center py-12">
                <i class="fas fa-book-open text-4xl text-gray-300 mb-4"></i>
                <h3 class="text-gray-600 mb-2">No Study Material</h3>
                <p class="text-gray-500">Upload and process a PDF to generate study material.</p>
            </div>
        `;
        return;
    }
    
    // Create chapter navigation
    AppState.chapters.forEach((chapter, index) => {
        const button = document.createElement('button');
        button.className = `chapter-btn ${index === 0 ? 'active' : ''}`;
        button.textContent = chapter.title;
        button.dataset.chapterId = chapter.id;
        button.addEventListener('click', () => showChapter(chapter.id));
        chapterNav.appendChild(button);
    });
    
    // Show first chapter
    showChapter(AppState.chapters[0].id);
}

function showChapter(chapterId) {
    const chapter = AppState.chapters.find(c => c.id === chapterId);
    if (!chapter) return;
    
    // Update active button
    document.querySelectorAll('.chapter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.chapterId === chapterId);
    });
    
    // Display chapter content
    const chapterContent = document.getElementById('chapterContent');
    chapterContent.innerHTML = `
        <div class="chapter-content active">
            <h2>${chapter.title}</h2>
            <div style="white-space: pre-wrap; line-height: 1.6;">${chapter.content}</div>
        </div>
    `;
}

function updateQuizUI() {
    const questions = AppState.currentQuiz.questions;
    const currentIndex = AppState.currentQuiz.currentIndex;
    
    if (questions.length === 0) {
        document.getElementById('questionText').textContent = 'No questions available. Generate questions first.';
        document.getElementById('optionsGrid').innerHTML = '';
        return;
    }
    
    const currentQuestion = questions[currentIndex];
    
    // Update question info
    document.getElementById('currentQuestion').textContent = currentIndex + 1;
    document.getElementById('totalQuestions').textContent = questions.length;
    document.getElementById('questionText').textContent = currentQuestion.question;
    
    // Update question navigator
    updateQuestionNavigator();
    
    // Update options
    const optionsGrid = document.getElementById('optionsGrid');
    optionsGrid.innerHTML = '';
    
    currentQuestion.options.forEach((option, index) => {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'option';
        optionDiv.dataset.optionIndex = index;
        
        const isAnswered = AppState.currentQuiz.userAnswers[currentIndex] !== undefined;
        const isSelected = AppState.currentQuiz.userAnswers[currentIndex] === index;
        
        if (isAnswered) {
            if (index === currentQuestion.correctAnswer) {
                optionDiv.classList.add('correct');
            } else if (isSelected) {
                optionDiv.classList.add('incorrect');
            }
            optionDiv.classList.add('disabled');
        } else if (isSelected) {
            optionDiv.classList.add('selected');
        }
        
        optionDiv.innerHTML = `
            <div class="option-letter">${String.fromCharCode(65 + index)}</div>
            <div>${option}</div>
        `;
        
        if (!isAnswered) {
            optionDiv.addEventListener('click', () => selectOption(index));
        }
        
        optionsGrid.appendChild(optionDiv);
    });
    
    // Update button states
    document.getElementById('prevBtn').disabled = currentIndex === 0;
    document.getElementById('nextBtn').disabled = currentIndex === questions.length - 1;
    document.getElementById('submitAnswerBtn').disabled = AppState.currentQuiz.userAnswers[currentIndex] !== undefined;
    document.getElementById('submitQuizBtn').disabled = Object.keys(AppState.currentQuiz.userAnswers).length < questions.length;
    
    // Update hint
    const hintText = document.getElementById('hintText');
    hintText.textContent = currentQuestion.explanation || 'No hint available for this question.';
    hintText.style.display = 'none';
}

function updateQuestionNavigator() {
    const questionNav = document.getElementById('questionNav');
    const questions = AppState.currentQuiz.questions;
    const currentIndex = AppState.currentQuiz.currentIndex;
    
    questionNav.innerHTML = '';
    
    questions.forEach((_, index) => {
        const dot = document.createElement('div');
        dot.className = 'question-dot';
        
        if (index === currentIndex) {
            dot.classList.add('active');
        }
        
        if (AppState.currentQuiz.userAnswers[index] !== undefined) {
            const isCorrect = AppState.currentQuiz.userAnswers[index] === questions[index].correctAnswer;
            dot.classList.add(isCorrect ? 'correct' : 'incorrect');
            dot.classList.add('answered');
        }
        
        if (AppState.currentQuiz.flaggedQuestions.has(index)) {
            dot.innerHTML = `<i class="fas fa-flag"></i>`;
        } else {
            dot.textContent = index + 1;
        }
        
        dot.addEventListener('click', () => {
            AppState.currentQuiz.currentIndex = index;
            updateQuizUI();
        });
        
        questionNav.appendChild(dot);
    });
}

function selectOption(optionIndex) {
    const currentIndex = AppState.currentQuiz.currentIndex;
    const currentQuestion = AppState.currentQuiz.questions[currentIndex];
    
    // Record answer
    AppState.currentQuiz.userAnswers[currentIndex] = optionIndex;
    
    // Check if correct
    const isCorrect = optionIndex === currentQuestion.correctAnswer;
    if (isCorrect) {
        AppState.currentQuiz.correctCount++;
        AppState.currentQuiz.score += 10; // 10 points per correct answer
    }
    
    // Update UI
    updateQuizUI();
    
    // Auto-advance after delay if not last question
    if (currentIndex < AppState.currentQuiz.questions.length - 1) {
        setTimeout(() => {
            if (AppState.currentQuiz.currentIndex === currentIndex) {
                AppState.currentQuiz.currentIndex++;
                updateQuizUI();
            }
        }, 1500);
    }
}

function submitQuiz() {
    const questions = AppState.currentQuiz.questions;
    const answeredCount = Object.keys(AppState.currentQuiz.userAnswers).length;
    
    if (answeredCount < questions.length) {
        showToast('Warning', `You have answered ${answeredCount} out of ${questions.length} questions. Are you sure you want to submit?`, 'warning');
        return;
    }
    
    // Calculate final score
    const percentage = (AppState.currentQuiz.correctCount / questions.length) * 100;
    const passingScore = parseInt(document.getElementById('passingScore').value);
    
    // Update results display
    document.getElementById('scorePercentage').textContent = `${percentage.toFixed(1)}%`;
    document.getElementById('correctCount').textContent = `${AppState.currentQuiz.correctCount} / ${questions.length}`;
    
    // Calculate time taken
    const timeTaken = AppState.currentQuiz.startTime ? 
        Math.floor((Date.now() - AppState.currentQuiz.startTime) / 1000) : 0;
    document.getElementById('timeTaken').textContent = `${timeTaken}s`;
    
    // Determine performance
    let performance = 'Excellent';
    if (percentage < 60) performance = 'Needs Improvement';
    else if (percentage < 70) performance = 'Satisfactory';
    else if (percentage < 80) performance = 'Good';
    else if (percentage < 90) performance = 'Very Good';
    document.getElementById('performance').textContent = performance;
    
    // Build results list
    const resultsList = document.getElementById('resultsList');
    resultsList.innerHTML = '';
    
    questions.forEach((question, index) => {
        const userAnswer = AppState.currentQuiz.userAnswers[index];
        const isCorrect = userAnswer === question.correctAnswer;
        
        const resultItem = document.createElement('div');
        resultItem.className = `result-item ${isCorrect ? 'correct' : 'incorrect'}`;
        
        resultItem.innerHTML = `
            <div class="result-question">Q${index + 1}: ${question.question}</div>
            <div class="result-answer">
                <strong>Your answer:</strong> 
                ${question.options[userAnswer] || 'Not answered'}
            </div>
            <div class="result-answer">
                <strong>Correct answer:</strong> 
                ${question.options[question.correctAnswer]}
            </div>
            ${question.explanation ? `
                <div class="result-explanation">
                    <strong>Explanation:</strong> ${question.explanation}
                </div>
            ` : ''}
        `;
        
        resultsList.appendChild(resultItem);
    });
    
    // Switch to results tab
    setActiveTab('results');
    
    // Show result toast
    if (percentage >= passingScore) {
        showToast('Congratulations!', `You passed with ${percentage.toFixed(1)}%!`, 'success');
    } else {
        showToast('Keep Practicing', `You scored ${percentage.toFixed(1)}%. Try again!`, 'warning');
    }
}

/* ===========================
   EVENT LISTENERS & INITIALIZATION
   =========================== */
document.addEventListener('DOMContentLoaded', function() {
    // Tab navigation
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
            setActiveTab(tab.dataset.tab);
        });
    });
    
    // File upload
    document.getElementById('browseBtn').addEventListener('click', () => {
        document.getElementById('pdfFileInput').click();
    });
    
    document.getElementById('pdfFileInput').addEventListener('change', (e) => {
        if (e.target.files[0]) {
            processPDF(e.target.files[0]);
        }
    });
    
    document.getElementById('clearFileBtn').addEventListener('click', () => {
        document.getElementById('pdfFileInput').value = '';
        document.getElementById('fileInfo').classList.remove('show');
        AppState.pdfText = '';
        AppState.pdfFileName = '';
    });
    
    // Drag and drop
    const uploadArea = document.getElementById('uploadArea');
    
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }
    
    ['dragenter', 'dragover'].forEach(eventName => {
        uploadArea.addEventListener(eventName, () => {
            uploadArea.classList.add('drag-over');
        }, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, () => {
            uploadArea.classList.remove('drag-over');
        }, false);
    });
    
    uploadArea.addEventListener('drop', (e) => {
        const dt = e.dataTransfer;
        const file = dt.files[0];
        if (file && file.type === 'application/pdf') {
            processPDF(file);
        }
    });
    
    // Quiz generation
    document.getElementById('generateQuizBtn').addEventListener('click', generateQuestions);
    
    document.getElementById('resetConfigBtn').addEventListener('click', () => {
        document.getElementById('numQuestions').value = '20';
        document.getElementById('difficulty').value = 'intermediate';
        document.getElementById('questionTypes').value = 'definition';
        document.getElementById('focusAreas').value = '';
        document.getElementById('timeLimit').value = '0';
        document.getElementById('passingScore').value = '70';
        showToast('Settings Reset', 'Quiz settings restored to defaults', 'info');
    });
    
    // Quiz navigation
    document.getElementById('prevBtn').addEventListener('click', () => {
        if (AppState.currentQuiz.currentIndex > 0) {
            AppState.currentQuiz.currentIndex--;
            updateQuizUI();
        }
    });
    
    document.getElementById('nextBtn').addEventListener('click', () => {
        if (AppState.currentQuiz.currentIndex < AppState.currentQuiz.questions.length - 1) {
            AppState.currentQuiz.currentIndex++;
            updateQuizUI();
        }
    });
    
    document.getElementById('submitAnswerBtn').addEventListener('click', () => {
        const currentIndex = AppState.currentQuiz.currentIndex;
        if (AppState.currentQuiz.userAnswers[currentIndex] === undefined) {
            showToast('Select Answer', 'Please select an answer first', 'warning');
        }
    });
    
    document.getElementById('submitQuizBtn').addEventListener('click', submitQuiz);
    
    document.getElementById('hintBtn').addEventListener('click', () => {
        const hintText = document.getElementById('hintText');
        hintText.style.display = hintText.style.display === 'none' ? 'block' : 'none';
    });
    
    document.getElementById('flagBtn').addEventListener('click', () => {
        const currentIndex = AppState.currentQuiz.currentIndex;
        if (AppState.currentQuiz.flaggedQuestions.has(currentIndex)) {
            AppState.currentQuiz.flaggedQuestions.delete(currentIndex);
            showToast('Flag Removed', 'Question unflagged', 'info');
        } else {
            AppState.currentQuiz.flaggedQuestions.add(currentIndex);
            showToast('Question Flagged', 'You can review flagged questions later', 'info');
        }
        updateQuestionNavigator();
    });
    
    // Results actions
    document.getElementById('reviewBtn').addEventListener('click', () => {
        setActiveTab('quiz');
        AppState.currentQuiz.currentIndex = 0;
        updateQuizUI();
    });
    
    document.getElementById('retryBtn').addEventListener('click', () => {
        // Reset quiz state
        AppState.currentQuiz.userAnswers = {};
        AppState.currentQuiz.currentIndex = 0;
        AppState.currentQuiz.score = 0;
        AppState.currentQuiz.correctCount = 0;
        AppState.currentQuiz.flaggedQuestions.clear();
        AppState.currentQuiz.startTime = Date.now();
        
        setActiveTab('quiz');
        updateQuizUI();
        showToast('Quiz Reset', 'Starting new attempt', 'info');
    });
    
    document.getElementById('saveResultsBtn').addEventListener('click', () => {
        showModal('saveModal', true);
    });
    
    // Save modal
    document.getElementById('closeSaveModal').addEventListener('click', () => {
        showModal('saveModal', false);
    });
    
    document.getElementById('cancelSaveBtn').addEventListener('click', () => {
        showModal('saveModal', false);
    });
    
    document.getElementById('confirmSaveBtn').addEventListener('click', () => {
        const title = document.getElementById('quizTitle').value.trim();
        const description = document.getElementById('quizDescription').value.trim();
        const category = document.getElementById('saveCategory').value;
        
        if (!title) {
            showToast('Error', 'Please enter a quiz title', 'error');
            return;
        }
        
        // Save quiz to localStorage
        const savedQuiz = {
            id: `quiz-${Date.now()}`,
            title,
            description,
            category,
            date: new Date().toISOString(),
            questions: AppState.currentQuiz.questions,
            results: {
                score: AppState.currentQuiz.score,
                correctCount: AppState.currentQuiz.correctCount,
                totalQuestions: AppState.currentQuiz.questions.length,
                percentage: (AppState.currentQuiz.correctCount / AppState.currentQuiz.questions.length * 100).toFixed(1)
            }
        };
        
        // Load existing saved quizzes
        const savedQuizzes = JSON.parse(localStorage.getItem('pdfQuizzes') || '[]');
        savedQuizzes.unshift(savedQuiz);
        
        // Keep only last 50 quizzes
        if (savedQuizzes.length > 50) {
            savedQuizzes.length = 50;
        }
        
        localStorage.setItem('pdfQuizzes', JSON.stringify(savedQuizzes));
        
        showModal('saveModal', false);
        showToast('Success', 'Quiz saved successfully!', 'success');
        
        // Clear form
        document.getElementById('quizTitle').value = '';
        document.getElementById('quizDescription').value = '';
    });
    
    // Print study material
    document.getElementById('printStudyBtn').addEventListener('click', () => {
        window.print();
    });
    
    // Refresh saved quizzes
    document.getElementById('refreshSavedBtn').addEventListener('click', () => {
        loadSavedQuizzes();
    });
    
    // Initialize
    loadSavedQuizzes();
    setActiveTab('upload');
});

function loadSavedQuizzes() {
    const savedQuizzes = JSON.parse(localStorage.getItem('pdfQuizzes') || '[]');
    const savedQuizzesGrid = document.getElementById('savedQuizzesGrid');
    
    if (savedQuizzes.length === 0) {
        savedQuizzesGrid.innerHTML = `
            <div class="text-center py-12">
                <i class="fas fa-inbox text-4xl text-gray-300 mb-4"></i>
                <h3 class="text-gray-600 mb-2">No Saved Quizzes</h3>
                <p class="text-gray-500">Generate and save your first quiz to see it here.</p>
            </div>
        `;
        return;
    }
    
    savedQuizzesGrid.innerHTML = '';
    
    savedQuizzes.forEach(quiz => {
        const quizCard = document.createElement('div');
        quizCard.className = 'quiz-card';
        
        const date = new Date(quiz.date);
        const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        
        quizCard.innerHTML = `
            <div class="quiz-card-header">
                <div class="quiz-card-title">${quiz.title}</div>
                <span class="text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded">${quiz.category}</span>
            </div>
            <div class="quiz-card-meta">
                <span><i class="fas fa-calendar"></i> ${formattedDate}</span>
                <span><i class="fas fa-file-alt"></i> ${quiz.questions.length} questions</span>
            </div>
            ${quiz.description ? `<p class="text-sm text-gray-600 mb-3">${quiz.description}</p>` : ''}
            <div class="quiz-card-stats">
                <div class="quiz-stat">
                    <i class="fas fa-trophy"></i>
                    <span>Score: ${quiz.results.percentage}%</span>
                </div>
                <div class="quiz-stat">
                    <i class="fas fa-check-circle"></i>
                    <span>${quiz.results.correctCount}/${quiz.questions.length} correct</span>
                </div>
            </div>
            <div class="quiz-actions">
                <button class="btn btn-outline btn-sm w-full load-quiz-btn" data-quiz-id="${quiz.id}">
                    <i class="fas fa-play"></i> Load Quiz
                </button>
            </div>
        `;
        
        savedQuizzesGrid.appendChild(quizCard);
    });
    
    // Add event listeners to load buttons
    document.querySelectorAll('.load-quiz-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const quizId = e.target.closest('.load-quiz-btn').dataset.quizId;
            const quiz = savedQuizzes.find(q => q.id === quizId);
            
            if (quiz) {
                AppState.currentQuiz.questions = quiz.questions;
                AppState.currentQuiz.userAnswers = {};
                AppState.currentQuiz.currentIndex = 0;
                AppState.currentQuiz.score = 0;
                AppState.currentQuiz.correctCount = 0;
                AppState.currentQuiz.flaggedQuestions.clear();
                
                updateQuizUI();
                setActiveTab('quiz');
                showToast('Quiz Loaded', `"${quiz.title}" loaded successfully`, 'success');
            }
        });
    });
}
</script>
</body>
</html>